#!/bin/dash

# A script to use dmenu to change the light
# FOR REFERENCE: xrandr --output eDP1 --brightness 1 
GS=$(xrandr  | grep -w connected | awk 'BEGIN {printf "auto\n"} {printf "%s\n", $1} END {printf "xrandr"}' | dmenu -f -p "Monitor: (`light`)")
INDICATOR_PATH="$HOME/.config/indicators"
INDICATOR_FILE="${INDICATOR_PATH}/light.ind"

eDP1() {
    killall clight
    echo "" > ${INDICATOR_FILE}
	
    BT=`printf "10\n50\n100" | dmenu -f -p "Set the brightness"`
    light -S ${BT}
    notify-send -u low "Light" "Screen monitor set to $GS"
}

HDMI1() {
    killall clight
    echo "" > ${INDICATOR_FILE}

    BT=`printf "10\n50\n100" | dmenu -f -p "Set the brightness"`
    ddcutil setvcp 10 ${BT}
    notify-send -u low "Light" "Screen monitor set to $GS"
}

both() {
    if [ ! -z "$GS" ]; then
	    killall clight
	    echo "" > ${INDICATOR_FILE}

	    light -S ${GS}
	    ddcutil setvcp 10 ${GS}

	    notify-send -u low "Light" "Screen monitor set to $GS"
    fi
}

_xrandr() {
    killall clight
    echo "" > ${INDICATOR_FILE}

    xrandr --output eDP1 --brightness 1 
    xrandr --output HDMI1 --brightness 1 
    
    
    notify-send -u low "Light" "Xrand reseted"
}

auto() {
    killall clight
    clight&
    
    echo ðŸ”† > ${INDICATOR_FILE}
    notify-send -u low "Light" "Auto"
}

case "$GS" in
    "auto") auto;;
    "eDP1") eDP1;;
    "HDMI1") HDMI1;;
    "xrandr") _xrandr;;
    *) both;;
esac
